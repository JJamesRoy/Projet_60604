---
title: "Projet BIXI - Partie 2: Modèle de régression linéaire"
subtitle: "MATH60604 - Modélisation statistique"
author: "Abdoul Wassi Badirou, Alfred Assal, James Roy, Samuel Croteau"
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
    toc: true
    toc_depth: 3
    extra_dependencies: ["flafter"]
  bookdown::html_document2:
    toc: true 
    number_sections: true
    toc_float: # to float the table of contents to the left of the main document content.
      collapsed: false
  html_document:
    toc: true 
    number_sections: true
    toc_float: # to float the table of contents to the left of the main document content.
      collapsed: false

params:
  created_date: '2023-09-12'
---

# Note

Question : Comment maximiser les déplacements en Bixi pour accélérer la transition vers une économie verte et réduire l'impact sur l'environnement des moyens de transports.

Sous question : 
- Impact de l'événementiel (James)
- Est-ce que la densité de population du quartier a un impact sur l'utilisation des Bixi (Alfred)
- Attraits touristiques (https://donnees.montreal.ca/dataset/installations-recreatives-sportives-et-culturelles/resource/1c239e86-8b36-476c-bd51-91a3cd20f687) (https://donnees.montreal.ca/dataset/lieux-d-interet/resource/edce22aa-f7cc-495e-9c53-b367f68309f6) (Abdoul)
- Parc (https://donnees.montreal.ca/dataset/grands-parcs-parcs-d-arrondissements-et-espaces-publics) (Sam)

Leviers de Bixi : Publicité et marketing sur le service et l'abonnement. Programme incitation Bixi (alléger les stations ou remplir)

Variables cibles : n_tot et dur

Variables à ajouter : merge avec les autres données par sous-question

```{r}
library(tidyverse)
library(readxl)
```

```{r}
dat = read.csv("bixifull.csv")
```

```{r festival}
festivals <- data.frame(
  Start_Date = as.Date(c("2021-05-10", "2021-05-22", "2021-05-27", "2021-06-06", "2021-06-07",
                         "2021-06-07", "2021-06-07", "2021-06-11", "2021-06-13", "2021-06-14",
                         "2021-06-20", "2021-06-26", "2021-06-27", "2021-06-29", "2021-07-04",
                         "2021-07-05", "2021-07-06", "2021-07-09", "2021-07-10",
                         "2021-07-11", "2021-07-11", "2021-07-22", "2021-07-27", "2021-07-28",
                         "2021-08-02", "2021-08-06", "2021-08-07", "2021-08-08", "2021-08-09",
                         "2021-08-09", "2021-08-19", "2021-08-20", "2021-08-29", "2021-08-30")),
  End_Date = as.Date(c("2021-05-17", "2021-06-04", "2021-06-16", "2021-06-16", "2021-06-09",
                       "2021-06-16", "2021-06-09", "2021-06-16", "2021-06-16", "2021-06-22",
                       "2021-06-23", "2021-06-30", "2021-07-06", "2021-07-27", "2021-07-14",
                       "2021-07-07", "2021-07-06", "2021-07-14", "2021-07-21", "2021-07-28",
                       "2021-07-27", "2021-08-01", "2021-07-28", "2021-07-28", "2021-08-04",
                       "2021-08-14", "2021-08-11", "2021-08-18", "2021-08-10", "2021-08-18",
                       "2021-08-24", "2021-08-25", "2021-09-02", "2021-09-02"))
)

dates <- festivals %>%
  rowwise() %>%
  mutate(Date = list(seq(Start_Date, End_Date, by = "day"))) %>%
  unnest(Date)

result_df <- dates %>%
  group_by(Date) %>%
  summarize(festival = n())

dat$Date <- as.Date(paste("2021", dat$mm, dat$dd, sep = "-"))

dat <- dat %>%
  left_join(result_df, by = "Date")

dat$festival[is.na(dat$festival)] = 0
```

```{r rain}
dat = dat %>% mutate(rain_bin = ifelse(rain == 0, 0, 1))
```

# Modèle avec festival


# Parc

Données utilisées:
https://donnees.montreal.ca/dataset/installations-recreatives-sportives-et-culturelles/resource/1c239e86-8b36-476c-bd51-91a3cd20f687
https://donnees.montreal.ca/dataset/grands-parcs-parcs-d-arrondissements-et-espaces-publics
https://donnees.montreal.ca/dataset/lieux-culturels

```{r}
#get data
data_parc <- read.csv("espace_vert.csv")
data_es <- read.csv("terrain_sport_ext.csv")
data_lc <- read_excel("lieuxculturels.xls")


#Parcs
nb_arrond_parc <- (table(data_parc$GESTION))
dat_nb_parc <- data.frame(arrond = names(nb_arrond_parc), nb_parc = as.numeric(nb_arrond_parc))
dat_parc <- dat %>%
  select(dur, n_tot, rev, arrond) %>% 
  group_by(arrond) %>%
  summarise(dur = (sum(dur)))
dat_nb_parc$arrond <- tolower(gsub("\\s+", "", dat_nb_parc$arrond))
dat_nb_parc$arrond<-gsub("-", "", dat_nb_parc$arrond)
dat_parc$arrond <- tolower(gsub("\\s+", "", dat_parc$arrond))
dat_parc$arrond<-gsub("-", "", dat_parc$arrond)

df_parc <- merge(dat_parc, dat_nb_parc, by = "arrond", all.x = TRUE)
df_parc$nb_parc <- ifelse(is.na(df_parc$nb_parc), 0, df_parc$nb_parc)

#Espaces sportives
nb_arrond_es <- table(data_es$ARROND)
dat_nb_es <- data.frame(arrond = names(nb_arrond_es), nb_es = as.numeric(nb_arrond_es))
dat_nb_es$arrond <- tolower(gsub("\\s+", "", dat_nb_es$arrond))
dat_nb_es$arrond<-gsub("-", "", dat_nb_es$arrond)

dat_es <- dat_parc
df_es <- merge(dat_es, dat_nb_es, by = "arrond", all.x = TRUE)

#Lieux culturels
nb_arrond_lc <- table(data_lc$Arrondissement)
dat_nb_lc <- data.frame(arrond = names(nb_arrond_lc), nb_lc = as.numeric(nb_arrond_lc))
dat_nb_lc$arrond <- tolower(gsub("\\s+", "", dat_nb_lc$arrond))
dat_nb_lc$arrond<-gsub("-", "", dat_nb_lc$arrond)
dat_nb_lc$arrond <- gsub("[-–]", "", dat_nb_lc$arrond)

dat_lc <- dat_parc
df_lc <- merge(dat_lc, dat_nb_lc, by = "arrond", all.x = TRUE)


#Modèles vs rev
df_parc_es <- merge(df_parc, dat_nb_es, by = "arrond", all.x = TRUE)
df_parc_es_lc <- merge(df_parc_es, dat_nb_lc, by = "arrond", all.x = TRUE)
df_parc_es_lc <- replace(df_parc_es_lc, is.na(df_parc_es_lc), 0)

modele4 = lm(dur~nb_parc + nb_es + nb_lc, data = df_parc_es_lc)

```

