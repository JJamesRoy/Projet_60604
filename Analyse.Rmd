---
title: "Projet BIXI - Partie 1: Analyse exploratoire"
subtitle: "MATH60604 - Modélisation statistique"
author: "James Roy,Alfred Assal,Samuel Croteau,Abdoul Wassi Badirou"
date: "`r Sys.Date()`"
output: 
  #bookdown::pdf_document2:
  bookdown::html_document2:
    toc: true 
    number_sections: true
    toc_float: # to float the table of contents to the left of the main document content.
      collapsed: false
  pdf_document:
  html_document:
    toc: true 
    number_sections: true
    toc_float: # to float the table of contents to the left of the main document content.
      collapsed: false
params:
  created_date: '2023-09-12'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(error = FALSE)
```

```{r}
library(tidyverse)
library(ggthemes)
library(RColorBrewer)
library(knitr)
```

# Notes

## Analyse exploratoire

Les variables cibles sont:

-   Utilisation: `n_Tot`

-   Durée: `dur`

-   Revenu: `rev`

### Analyse univariée

-   Encoder les variables qualitatives avec le as.factor

-   Histogramme de nombre de station par rapport à la fréquence (nom)

    -   s'interroger sur les cas extrêmes

    -   voir si la distribution est normal ou skewed

    -   vérifier s'il y a des valeurs manquantes et essayer de les justifier

-   Pourcentage des membres et non membres

-   Pour les variables qualitatives

    -   vérifier s'il y a des valeurs manquantes et essayer de les justifier

    -   boxplot et distribution

        -   Voir les valeurs abérantes et/ou extrêmes

### Analyse multivariée

-   Samuel: n_Tot

-   Alfred: rev

-   James: dur

-   Identifier le meilleur moment qui maximise l'utilisation des bixi.

-   Avec les données géographiques, identifier le meilleur endroit où il y a le plus d'apétence pour les bixi.

-   Voir s'il y a une relation à faire entre les stations les plus fréquentées et l'arrondissement

-   Comparaison entre variables explicatives et variables objectives

    -   moy n_tot vs température, pluie , jour de la semaine, weekend, AM, PM

    -   jours de la semaine Vs weekend

    -   Fériés Vs Non fériée

    -   Nombre de

-   Comparaison entres variables explicatives (covariables)

-   Vérifier par exemple si n_tot=n_AM + n_PM

    -   Rajouter la variable n_Nuit=n_tot-n_AM-n_PM

-   relation entre nombre total de déplacement et le revenu. Ca dépend de la proportion des membres. Car c'est possible qu'on ai des membres qui font beaucoup de déplacement mais pour lesquels on n'a pas de revenu.

-   Est-ce que les membres utilisent plus le bixi que les non-membres

-   Qui rapporte le plus entre les membres et non-membres

-   On peut calculer la corrélation entre les variables.

```{r}
dat = read.csv("bixi1.csv")

```

# Introduction

1.  Contexte
2.  Objectif
3.  Plan

# Exploration des données

Le jeu de données utilisé est fourni dans le fichier `bixi1.csv`. La première ligne du fichier est constituée des noms des différentes variables. La virgule est le séparateur du fichier `csv` et la décimale est représentée par un point.

Les tables \@ref(tab:6PremieresObservations) et \@ref(tab:6DernieresObservations) nous montrent à titre informatif, respectivement les 6 premières et 6 dernières observations du jeu de données. Nous retrouvons les variables telles que décrites dans le document xxx.

```{r imp-data}
#Importation des données
bixi_raw_data_df= dat
#bixi_raw_data_df=read.table("raw_data/bixi1.csv", sep = ",", header = T)
```

```{r 6PremieresObservations}
knitr::kable(head(bixi_raw_data_df), caption="6 premières observations du jeu de données")
```

```{r 6DernieresObservations}
knitr::kable(tail(bixi_raw_data_df), caption="6 dernières observations du jeu de données")
```

La visualisation de la structure compacte des données exposée ci-dessous, nous montre que le jeu de données est constitué de 10000 observations et 14 variables. Toutes les variables sont encodées numériquement à l'exception de la variable `wday` qui indique le jour de la semaine. Les six premières variables (de `station` à `holiday`) sont à priori des variables qualitatives. Nous les encoderons donc comme tels. Par ailleurs, certaines sont ordinalles, comme le mois (variable `mm`), le jour du mois (variable `dd`) et le jour de la semaine (variable `wday`). Nous y reviendrons plus en détails dans l'analyse exploratoire associée à chacune d'elles.

```{r dataStr, fig.cap="Structure du jeu de données"}
str(bixi_raw_data_df)
```

Après avoir encodé les 6 premières variables sous-forme qualitatives, le tableau présente une description sommaire des différentes variables. Regardons à présent de facon détaillée chacune d'elle.

```{r}
options(knitr.kable.NA = "")
bixi_df=data.frame(station=as.factor(bixi_raw_data_df$station),
                   mm=as.factor(bixi_raw_data_df$mm),
                   dd=as.factor(bixi_raw_data_df$dd),
                   wday=as.factor(bixi_raw_data_df$wday),
                   mem=as.factor(bixi_raw_data_df$mem),
                   holiday=as.factor(bixi_raw_data_df$holiday),
                   bixi_raw_data_df[,7:ncol(bixi_raw_data_df)])
knitr::kable(summary(bixi_df), caption="Sommaire des observations")
```

## Exploration univariée

### Les variables qualitatives

#### Station

La variable station est une variable qualitative qui représente les différentes stations de départ des trajets en BIXI. Nous l'avons encodé sous forme de variable qualitative nominale car il n'y a pas de relation d'ordre entre les différentes stations. La figure \@ref(fig:histNbObservationStation) montre le nombre de stations en fonction du nombres de leur observations dans les données.

```{r histNbObservationStation, fig.cap="Histogramme du nombre d'observations des stations"}
freqTable_station=table(bixi_df$station)
hist(freqTable_station, xlab = "Nombre d'observations", ylab = "Nombre de stations", main = "Histogramme du nombre d'observations des stations")
```

### Les variables quantitatives

## Exploration multivariée

### Exploration des relations avec la durée des trajets

En croisant la variable `dur` avec la variable `wday` qui représente les jours de la semaine et `mem` qui représente l'abonnement, nous pouvons obtenir le figure @ref(fig:dur_day). Plusieurs analyses sont pertinentes à partir de ce graphique. D'abord, les membres utilisent beaucoup plus les Bixi (au niveau de la durée) que les non-membres, et ce, peu importe le jour de la semaine. Les types d'utilisation semblent aussi changé, par exemple, les non-membres utilisent plus les Bixi les fin de semaines alors que pour les membres, la tendance semble moins claire. En effet, les membres semblent avoir une utilisation croissante la semaine et décroissante la fin de semaine. Naturellemement, on pourrait penser que c'est parce qu'ils utilisent le Bixi comme un moyen de transport régulier pour aller au travail ou à l'école par exemple.

D'un point de vue d'affaire, il pourrait être intéressant pour l'entreprise Bixi de faire des accords avec les gros employeurs de Montréal pour augmenter ses clients et accélérer la transition vers des moyens de transport plus doux.

```{r}
dat$wday <- factor(dat$wday,
                   levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

label <- c(`1` = "Membre", `0` = "Non membre")
```

```{r dur_day}

dat %>% 
ggplot(aes(x=wday, y=dur,
           fill = wday)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Blues")+
  facet_wrap(~ mem,labeller=labeller(mem=label))+
  theme(legend.position="none")+
  labs(title = "Durée totale des déplacement \npar jours selon les membres et les non membres")+
  xlab("")+
  ylab("Durée totale (en minutes) des déplacement")
```

En croisant la variable `dur` avec la variable `mm` qui représente les mois où il est possible de prendre un Bixi et `mem` qui représente l'abonnement, nous pouvons obtenir le figure \@ref(fig:dur_mm). Plusieurs analyses sont pertinentes à partir de ce graphique. D'abord, les membres utilisent beaucoup plus les Bixi (au niveau de la durée) que les non-membres, et ce, peu importe le mois de l'année. D'une façon similaire, l'utilisation semble atteindre son pic vers août pour les deux types de clients. Il est aussi intéressant de constater que les membres utilisent moins les Bixi durant le moins de juillet. Cela semble concorder avec une affirmation précédente, les membres peuvent par exemple être en congé durant ce mois et ils utilisent donc moins les Bixi pour aller à leur occupation régulière.

```{r dur_mm}
ggplot(dat, aes(as.factor(mm), dur, fill = as.factor(mm))) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Blues")+
  facet_wrap(~ mem,labeller=labeller(mem=label))+
  theme(legend.position="none")+
  scale_x_discrete(breaks = 4:11,labels=c("Avril","Mai","Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre")) +
  labs(title = "Durée totale des déplacement \npar jours selon les membres et les non membres")+
  xlab("")+
  ylab("Durée totale (en minutes) des déplacement")
```

En croisant la variable `dur` avec la variable `temp` qui représente la température moyenne de la journée et `mem` qui représente l'abonnement, nous pouvons obtenir le figure \@ref(fig:dur_temp). Naturellement, on voit une relation positive entre la température moyenne et la durée totale de déplacement. La relation semble toutefois ralentir ou même s'inverser peu après les 20°C. Ce graphique donne globalement les mêmes informations que le précédent étant donné que la température est fortemement corrélée avec les mois.

Graphique corrélation pareil mais avec mois ?

```{r}
dat_temp <- dat %>%
  select(mem, dur, temp, avg) %>% 
  group_by(temp, mem) %>%
  summarise(dur = log(sum(dur)))
```

```{r dur_temp}
ggplot(dat_temp, aes(temp, dur)) +
  geom_point() +
  facet_wrap(~mem,labeller=labeller(mem=label)) +
  labs(title = "Durée totale des déplacement \npar jours selon les membres et les non membres")+
  xlab("Précipitation")+
  ylab("Log naturel de la durée totale des déplacement")
```

En croisant la variable `dur` avec la variable `rain` qui représente la précipitation totale de pluie lors de la journée et `mem` qui représente l'abonnement, nous pouvons obtenir le figure \@ref(fig:dur_rain). Il est intéressant de constater que la relation est très semblable pour les membres et les non-membres. En effet, il semble y avoir une relation inversement proportionnelle entre la pluie et la durée totale des déplacements. C'est-à-dire qu'un peu de pluie a un effet significatif sur l'utilisation, mais cela se stabilise rapidement.

```{r}
dat_rain <- dat %>%
  select(mem, dur, rain) %>% 
  group_by(rain, mem) %>%
  summarise(dur = log(sum(dur)))

```

```{r dur_rain}
ggplot(dat_rain, aes(rain, dur)) +
  geom_point() +
  facet_wrap(~mem,labeller=labeller(mem=label)) +
  labs(title = "Durée totale des déplacement \npar jours selon les membres et les non membres")+
  xlab("Température en °C")+
  ylab("Log naturel de la durée totale des déplacement")
```

En croisant la variable `dur` et `avg` avec `mem` qui représente l'abonnement, nous pouvons obtenir le tableau \@ref(tab:table_mem).

```{r}
dat_rain <- dat %>%
  select(mem, dur, rain) %>% 
  group_by(rain, mem) %>%
  summarise(dur = log(sum(dur)))
```

```{r table_mem}
kable(dat_mem, col.names = c("Membre", "Durée moyenne", "Durée totale"), caption = "Détail sur la durée selon les abonnements")
```

La durée moyennedes trajets est assez similaire entre les membres et les non-membres. Cela est assez intéressant, car il est facile de penser que les membres utiliseraient plus les Bixi pour des trajets plus long. En revanche, les membres ont une durée totale de trajets beaucoup plus haute que les non-membres, ce qui rejoint ce que nous avions observé précédemment.

# Conclusion {.unnumbered}

voir le tableau \@ref(tab:test)

```{r test}
knitr::kable(summary(dat), caption="tableau")

```

voir la figure \@ref(fig:member)

```{r member, fig.cap="Nom de la figure"}
donnees_summary <- dat %>%
  group_by(mem) %>%
  summarise(percentage = n() / nrow(dat) * 100)
# Création variable pour afficher en %

# Création du graphique à barres
ggplot(data = donnees_summary, aes(x = factor(mem), y = percentage, fill = factor(mem))) +
  geom_bar(stat = "identity") +
  guides(fill=guide_legend(title = "Membre"))+
  ggtitle("Pourcentage de membre et de non membre BIXI")+
  xlab("")+
  ylab("Pourcentage")+
  theme_minimal()
```

essaie de graph

```{r}
dat %>%  ggplot(aes(avg,temp))+
  geom_point()+
  theme_minimal()

dat %>% ggplot(aes(dur))+
  geom_density()
  


```
