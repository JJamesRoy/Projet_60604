---
title: "Projet BIXI - Partie 1: Analyse exploratoire"
subtitle: "MATH60604 - Modélisation statistique"
author: "James Roy,Alfred Assal,Samuel Croteau,Abdoul Wassi Badirou"
date: "`r Sys.Date()`"
output: 
  pdf_document:
  bookdown::html_document2:
    toc: true 
    number_sections: true
    toc_float: # to float the table of contents to the left of the main document content.
      collapsed: false
  #bookdown::pdf_document2:
  html_document:
    toc: true 
    number_sections: true
    toc_float: # to float the table of contents to the left of the main document content.
      collapsed: false
params:
  created_date: '2023-09-12'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(error = FALSE)
```

```{r}
library(tidyverse)
library(ggthemes)
library(RColorBrewer)
library(knitr)
library(corrplot)
```

# Notes

## Analyse exploratoire

Les variables cibles sont:

-   Utilisation: `n_Tot`

-   Durée: `dur`

-   Revenu: `rev`

### Analyse univariée

-   Encoder les variables qualitatives avec le as.factor

-   Histogramme de nombre de station par rapport à la fréquence (nom)

    -   s'interroger sur les cas extrêmes

    -   voir si la distribution est normal ou skewed

    -   vérifier s'il y a des valeurs manquantes et essayer de les justifier

-   Pourcentage des membres et non membres

-   Pour les variables qualitatives

    -   vérifier s'il y a des valeurs manquantes et essayer de les justifier

    -   boxplot et distribution

        -   Voir les valeurs abérantes et/ou extrêmes

### Analyse multivariée

-   Samuel: n_Tot

-   Alfred: rev

-   James: dur

-   Identifier le meilleur moment qui maximise l'utilisation des bixi.

-   Avec les données géographiques, identifier le meilleur endroit où il y a le plus d'apétence pour les bixi.

-   Voir s'il y a une relation à faire entre les stations les plus fréquentées et l'arrondissement

-   Comparaison entre variables explicatives et variables objectives

    -   moy n_tot vs température, pluie , jour de la semaine, weekend, AM, PM

    -   jours de la semaine Vs weekend

    -   Fériés Vs Non fériée

    -   Nombre de

-   Comparaison entres variables explicatives (covariables)

-   Vérifier par exemple si n_tot=n_AM + n_PM

    -   Rajouter la variable n_Nuit=n_tot-n_AM-n_PM

-   relation entre nombre total de déplacement et le revenu. Ca dépend de la proportion des membres. Car c'est possible qu'on ai des membres qui font beaucoup de déplacement mais pour lesquels on n'a pas de revenu.

-   Est-ce que les membres utilisent plus le bixi que les non-membres

-   Qui rapporte le plus entre les membres et non-membres

-   On peut calculer la corrélation entre les variables.

### Questions
- Pour chaque station, avons-nous des données pour tous les jours de l'année et chaque catégorie de membre? grenre est-ce que nb_station X nb_jrs dans l'année X 2=nb_observations? 
- Quelles sont les stations qui génèrent le plus (ou le moins) de revenu?
  - Est-ce qu'il y a une corrélation entre les stations qui ont moins d'observations les stations qui ont moins de revenu? Idem pour ceux qui ont le plus d'observation.

```{r}
dat = read.csv("bixi1.csv")

```

# Introduction

1.  Contexte
2.  Objectif
3.  Plan

# Exploration des données

Le jeu de données utilisé est fourni dans le fichier `bixi1.csv`. La première ligne du fichier est constituée des noms des différentes variables. La virgule est le séparateur du fichier `csv` et la décimale est représentée par un point.La description du jeu de données est fournie dans xxx.

```{r imp-data}
#Importation des données
bixi_raw_data_df= dat
#bixi_raw_data_df=read.table("raw_data/bixi1.csv", sep = ",", header = T)
```

Les tables \@ref(tab:6PremieresObservations) et \@ref(tab:6DernieresObservations) nous montrent à titre informatif, respectivement les 6 premières et 6 dernières observations du jeu de données. Nous y retrouvons toutes les variables décrites dans le dictionnaire des données (ref vers document xxx). Il semble y avoir des valeurs différentes des variables réponses pour chaque observation, ce qui suggère que les données sont en format long. De plus, la variable réponse représentant le revenu (`rev`) comporte des valeurs manquantes. En effet, l'énoncé mentionne que les données de revenues ne sont pas disponibles pour les membres. Donc pour toutes les observations qui concernent les membres, on ne devrait retrouver aucune valeur de revenu dans les données. Nous le validerons dans l'analyse exploratoire multivariée à la section \@ref(explorationMultivariee).

```{r 6PremieresObservations}
knitr::kable(head(bixi_raw_data_df), caption="6 premières observations du jeu de données")
```

```{r 6DernieresObservations}
knitr::kable(tail(bixi_raw_data_df), caption="6 dernières observations du jeu de données")
```

La visualisation de la structure compacte des données exposée ci-dessous, nous montre que le jeu de données est constitué de 10000 observations et 14 variables. Toutes les variables sont encodées numériquement à l'exception de la variable `wday` qui indique le jour de la semaine. Les six premières variables (de `station` à `holiday`) sont à priori des variables catégorielles. Nous les encoderons donc comme tels. Par ailleurs, certaines devraient être ordinalles, comme le mois (variable `mm`), le jour du mois (variable `dd`) et le jour de la semaine (variable `wday`). Nous y reviendrons plus en détails dans l'analyse exploratoire associée à chacune d'elles. 

```{r dataStr, fig.cap="Structure du jeu de données"}
str(bixi_raw_data_df)
```

Après avoir encodé les 6 premières variables sous-forme qualitatives, le tableau présente une description sommaire des différentes variables. Regardons à présent de facon détaillée chacune d'elle.

```{r}
options(knitr.kable.NA = "")
bixi_df=data.frame(station=as.factor(bixi_raw_data_df$station),
                   mm=factor(bixi_raw_data_df$mm, ordered=T),
                   dd=factor(bixi_raw_data_df$dd, ordered = T),
                   wday=factor(bixi_raw_data_df$wday, 
                      levels=c('Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'), ordered=T),
                   mem=as.factor(bixi_raw_data_df$mem),
                   holiday=as.factor(bixi_raw_data_df$holiday),
                   bixi_raw_data_df[,7:ncol(bixi_raw_data_df)])
knitr::kable(summary(bixi_df), caption="Sommaire des observations")
```

## Exploration univariée

### Les variables qualitatives

#### Station

La variable station est une variable qualitative qui représente les différentes stations de départ des trajets en BIXI. Nous l'avons encodé sous forme de variable catégorielle nominale car il n'y a pas de relation d'ordre entre les différentes stations. Le jeu de données couvre `r n_distinct(bixi_df$station)` stations Bixi.  

La figure \@ref(fig:histNbObservationStation) montre le nombre de stations en fonction du nombre de leur observations dans les données. On constate qu'il n'y a pas le même nombre d'observations pour toutes les stations. Donc pour certaines stations, il y a des observations manquantes, soit pour une journée, soit pour un mois, soit pour une catégorie de membre. Celà est due au fait que le jeu de donnée que nous utilisons est un sous-ensemble aléatoire des données réelles. 

**Cette partie n'est surement pas pertinente**  
Pour en apprendre d'avantage, nous définissons une variable catégorielle ordonnée (`n_obs_cat`) qui représente l'intervalle de nombre d'observations dans laquelle chaque station se situe. Les catégories d'intervalles sont celles décrites sur l'axe des abscisses de la figure \@ref(fig:histNbObservationStation).


```{r histNbObservationStation, fig.cap="Histogramme du nombre d'observations des stations"}
freqTable_station=table(bixi_df$station)
#hist(freqTable_station, xlab = "Nombre d'observations", ylab = "Nombre de stations", main = "Histogramme du nombre d'observations des stations")

hist_step=5
max_freqTable_station=max(freqTable_station)
station_breaks=seq(0,ceiling(max_freqTable_station/hist_step)*hist_step,hist_step)
hist(freqTable_station,breaks=station_breaks,
     labels=T,ylim=c(0,300),xlab = "Nombre d'observations", ylab = "Nombre de stations", main = "Histogramme du nombre d'observations des stations")
```

```{r}
#Ajout de la colonne n_obs qui est le nombre d'observations de chaque station
freqTable_station_df=as.data.frame(freqTable_station)
colnames(freqTable_station_df)=c('station','n_obs')
bixi_df=merge(bixi_df,freqTable_station_df)
#head(bixi_df)
```
```{r results='hide'}
#Ajout de la colonne n_obs_cat: variable catégorielle qui représente l'intervalle
# du nombre d'observations dans laquelle chaque station se situe
bixi_df=data.frame(station=bixi_df$station,n_obs=bixi_df$n_obs,
                   n_obs_cat=cut(bixi_df$n_obs, breaks = station_breaks), bixi_df[,2:ncol(bixi_df)])
head(bixi_df)
```
```{r results='hide'}
stations_levels=levels(bixi_df$n_obs_cat)
station_df <- bixi_df %>%
  group_by(station) %>%
  summarise(dc_mm=n_distinct(mm), dc_mem=n_distinct(mem), n_obs_cat=first(n_obs_cat))
station_df=merge(station_df, freqTable_station_df)
station_df
```
```{r boxplotNbmmVsNbObs, fig.cap="Boîte à moustache du nombre de mois dans les observations par station en fonction des différentes catégories de nombre d'observations par station"}
boxplot(station_df$dc_mm~station_df$n_obs_cat, xlab = "Catégories d'intervalles du nombre d'observations par station",
        ylab = "Nombre de mois dans les observations par station")
```
La figure \@ref(fig:boxplotNbmmVsNbObs) nous montre que pour une station, nous avons entre 2 et 8 mois dans l'année pour lesquels nous avons des observations. Est-ce que l'absence d'observation pour les autres mois de l'année pour chaque station est due à la méthode de génération des sous-ensembles des données ou simplement au fait qu'il n'y a aucune activité à ces période. 

#### Mois
```{r}
saison_first_month=min(bixi_df$mm)
saison_last_month=max(bixi_df$mm)
```

Il s'agit d'une variable catégorielle ordonnée car les mois arrivent dans un ordre donné. La saison Bixi s'étend d'avril (`r saison_first_month`) à novembre (`r saison_last_month`) comme on peut le voir à la figure \@ref(fig:histMois). En dehors des mois d'avril et novembre, nous avons approximativement le même nombre d'observations par mois. Il y a environ 2 fois moins d'observations pour les mois d'avril et novembre. C'est cohérent avec le fait que la saison s'étend de la mi-avril à la mi-novembre. De ce point de vue, notre sous-ensemble de jeu de donnée est représentatif de la saison réelle.

```{r histMois, fig.cap="Histogramme des mois"}
freqTable_mm=table(bixi_df$mm)
bplot=barplot(freqTable_mm, ylim = c(0,max(freqTable_mm)+100), xlab="Mois", ylab="Nombre d'observations", main="Histogramme des mois")
text(bplot,freqTable_mm+50, labels=as.character(freqTable_mm))
```
La figure \@ref(fig:bpRevDurNtotParMois) nous montre que les mois d'avril et novembre (avril plus que novembre) sont ceux où il y a le moins de revenu, les bixi sont les moins utilisés et les utilisateurs font de plus courtes distances. Les mois d'août et septembre génèrent le plus de revenu. L'utilisation des bixi et la durée des trajets est plus importante de juin à septembre. En gros, les périodes creuses de l'année sont avril et novembre (surtout avril). Et les périodes pointent de l'année sont entre juin et septembre (surtout septembre).
```{r bpRevDurNtotParMois,fig.cap="Boîtes à moustaches des revenus, durée et nombre totale de déplacement en fonction du mois"}
par(mfrow=c(1,3))
boxplot(bixi_df$rev~bixi_df$mm, xlab = "Mois", ylab = "revenu total par déplacement")
boxplot(bixi_df$dur~bixi_df$mm, xlab = "Mois", ylab = "durée totale des déplacements")
boxplot(bixi_df$n_tot~bixi_df$mm, xlab = "Mois", ylab = "nombre total de déplacements")
```
Étant donné que le revenu des membres est manquant, faisons-nous le même constat pour les non-membres uniquement? La figure \@ref(fig:boxPlotVarCibleParMoisNonMembre) nous montre que le constat est identique et plus évident. Par ailleurs on observe l'absence des deux valeurs les plus extrêmes pour le nombre de total de déplacement en septembre. Celà suggère donc que le plus grand nombre de déplacement journalier a été fait par des usagers membres en septembre. Mais le plus long déplacement a été fait par des usagers non-memebres en août. On se demande donc si les usagers membres ont plus tendance à effectuer de nombreux trajets mais de courte distance et les usagers non-membres moins de trajet mais plus long. Nous y répondrons dans la section \@ref(univarieMembres).
```{r boxPlotVarCibleParMoisNonMembre,fig.cap="Boîtes à moustaches des revenus, durée et nombre totale de déplacement en fonction du mois pour les non-membre uniquement"}
bixi_nm_df=bixi_df[bixi_df$mem==0,]
par(mfrow=c(1,3))
boxplot(bixi_nm_df$rev~bixi_nm_df$mm, xlab = "Mois", ylab = "revenu total par déplacement")
boxplot(bixi_nm_df$dur~bixi_nm_df$mm, xlab = "Mois", ylab = "durée totale des déplacements")
boxplot(bixi_nm_df$n_tot~bixi_nm_df$mm, xlab = "Mois", ylab = "nombre total de déplacements")
```

```{r results='hide'}
bixi_df %>%
  group_by(mm) %>%
  summarise(mean.rev=mean(rev,na.rm = T), mean.dur=mean(dur,na.rm=T), mean.n_tot=mean(n_tot,na.rm = T))
```

#### Jour
```{r}
saison_first_day=min(bixi_df$dd[bixi_df$mm==saison_first_month])
saison_last_day=max(bixi_df$dd[bixi_df$mm==saison_last_month])
```

Il s'agit d'une variable catégorielle ordonnée. Les jours s'étendent du `r min(bixi_df$dd)` au `r max(bixi_df$dd)` en fonction des mois. Dans nos données, le premier jour de la saison est le `r saison_first_day` avril et le dernier jour de la saison est le `r saison_last_day` novembre. Or sur le site de Bixi, la saison commence le 15 avril. Il nous manque donc dans nos données la première semaine réelle de la saison.

Il y a environ 2 fois moins d'observations pour la journée du 31 par rapport aux autres mois. La distribution des autres jours semble approximativement uniforme.

```{r histJour, fig.cap="Histogramme des jours"}
freqTable_dd=table(bixi_df$dd)
bplot=barplot(freqTable_dd, ylim = c(0,max(freqTable_dd)+100), xlab="Jour", ylab="Nombre d'observations", main="Histogramme des jours")
#text(bplot,freqTable_dd+50, labels=as.character(freqTable_dd))
```
Les figures \@ref(fig:bpRevDurNtotParJour) et \@ref(fig:bpRevDurNtotParJourNonMembre) nous montrent que la journée du 24, une journée dans la dernière semaine de chaque mois, semble être la plus lucratif en revenu et la plus achalandée, aussi bien en terme de nombre de déplacement que de durée.
```{r bpRevDurNtotParJour,fig.cap="Boîtes à moustaches des revenus, durée et nombre totale de déplacement en fonction du jour."}
par(mfrow=c(1,3))
boxplot(bixi_df$rev~bixi_df$dd, xlab = "Jour", ylab = "revenu total par déplacement")
boxplot(bixi_df$dur~bixi_df$dd, xlab = "Jour", ylab = "durée totale des déplacements")
boxplot(bixi_df$n_tot~bixi_df$dd, xlab = "Jour", ylab = "nombre total de déplacements")
```
```{r bpRevDurNtotParJourNonMembre,fig.cap="Boîtes à moustaches des revenus, durée et nombre totale de déplacement en fonction du jour pour les non-membre uniquement."}
par(mfrow=c(1,3))
boxplot(bixi_nm_df$rev~bixi_nm_df$dd, xlab = "Jour", ylab = "revenu total par déplacement")
boxplot(bixi_nm_df$dur~bixi_nm_df$dd, xlab = "Jour", ylab = "durée totale des déplacements")
boxplot(bixi_nm_df$n_tot~bixi_nm_df$dd, xlab = "Jour", ylab = "nombre total de déplacements")
```

```{r results='hide'}
meanVarCibleByDay=bixi_df %>%
  group_by(dd) %>%
  summarise(mean.rev=mean(rev,na.rm = T), mean.dur=mean(dur,na.rm=T), mean.n_tot=mean(n_tot,na.rm = T))
knitr::kable(meanVarCibleByDay, caption="To add")
```
#### Jour de semaine
Il s'agit d'une variable catégorielle ordonnée. Mais le choix du premier jour est relatif. La figure \@ref(fig:histWday) nous montre que la distribution des jours de semaine est approximativement uniforme car nous avons environ le même nombre d'observations pour les différents jours de la semaine.
```{r histWday, fig.cap="Histogramme des jour de semaine"}
freqTable_wday=table(bixi_df$wday)
bplot=barplot(freqTable_wday, ylim = c(0,max(freqTable_wday)+100), xlab="Jour de semaine", ylab="Nombre d'observations", main="Histogramme des jour de semaine")
#text(bplot,freqTable_dd+50, labels=as.character(freqTable_dd))
```

```{r bpRevDurNtotParwday,fig.cap="Boîtes à moustaches des revenus, durée et nombre totale de déplacement en fonction des jours de semaine."}
mar=c(7,4,2,2)
dmar=par('mar')
par(mfrow=c(1,3), mar=mar)

bp_rev=boxplot(bixi_df$rev~bixi_df$wday, xlab = "", ylab = "revenu total par déplacement", las=2)
# tick=seq_along(bp_rev$names)
# axis(1,at=tick, labels = F)
# text(tick,par("usr")[3]-1,labels=bp_rev$names, srt=45)
#mtext('Jour de semaine', side=1, padj = 0, outer=T)
mtext('Jour de semaine', side=1,cex=0.9, line=mar[1]-1)
#box(which="figure", col="red")
bp_dur=boxplot(bixi_df$dur~bixi_df$wday, xlab = "", ylab = "durée totale des déplacements",las=2)
mtext('Jour de semaine', side=1,cex=0.9, line=mar[1]-1)
#box(which="figure", col="blue")
bp_n_tot=boxplot(bixi_df$n_tot~bixi_df$wday, xlab = "", ylab = "nombre total de déplacements",las=2)
mtext('Jour de semaine', side=1,cex=0.9, line=mar[1]-1)
#box(which="figure", col="green")
```
```{r, results='hide'}
bixi_thursday=bixi_df[bixi_df$wday=="Thursday",]
bixi_thursday[order(bixi_thursday$n_tot, decreasing = T),]
```

#### Membres {#univarieMembres}

Est-ce que les usagers membres ont plus tendance à effectuer de nombreux trajets mais de courte distance et les usagers non-membres, moins de trajet mais plus long?

Il s'agit d'une variable catégorielle nominale. La figure \@ref(fig:histmem) nous montre que la distribution est approximativement uniforme.
```{r histmem, fig.cap="Histogramme des types d'usager"}
freqTable_mem=table(bixi_df$mem)
bplot=barplot(freqTable_mem, ylim = c(0,max(freqTable_mem)+100), xlab="Types d'usagers: 1=membre, 0=non-membre", ylab="Nombre d'observations", main="Histogramme des types d'usagers")
#text(bplot,freqTable_dd+50, labels=as.character(freqTable_dd))
```


```{r, results='hide'}
# par(mar=c(5,4,4,2))
# par(oma=c(3,3,3,3))
# plot(0:10,0:10, xlab='X', ylab='y', type = 'n')
# text(5,5, "Plot", col="red", cex=2)
# box(col="red")
# box(which = "figure", col="green")
# box(which = "outer", col="blue")
# 
# mtext("Margins", side=3, line = 2, cex=2, col="forestgreen")
# mtext("par(mar=c(b,l,t,r))", side=3, line=1,cex=1, col="forestgreen")
# mtext("Line 0", side=3, line=0, adj=1.0, cex=1, col="forestgreen")
# mtext("Line 1", side=3, line=1, adj=1.0, cex=1, col="forestgreen")  
# mtext("Line 2", side=3, line=2, adj=1.0, cex=1, col="forestgreen")  
# mtext("Line 3", side=3, line=3, adj=1.0, cex=1, col="forestgreen")
# 
# mtext("Outer Margin Area", side=1, line=1, cex=2, col="blue", outer=TRUE)
# mtext("par(oma=c(b,l,t,r))", side=1, line=2, cex=1, col="blue", outer=TRUE)  
# mtext("Line 0", side=1, line=0, adj=0.0, cex=1, col="blue", outer=TRUE)  
# mtext("Line 1", side=1, line=1, adj=0.0, cex=1, col="blue", outer=TRUE)  
# mtext("Line 2", side=1, line=2, adj=0.0, cex=1, col="blue", outer=TRUE)
```


### Les variables quantitatives

## Exploration multivariée {#explorationMultivariee}

Avant de débuter l'exploration multivariée des variables cibles, il est important d'avoir une vue d'ensemble des relations entre les variables. Pour ce faire, une matrice de corrélation comme illustrer dans la figure \@ref(fig:MatricCorr) est une représentation simple qui permet de visualiser les tendances entre chaque variable. Par exemple, il est possible de voir que la corrélation entre `dur`et `rev` est de 0.99. De plus, les relations de `dur`et de `rev` vont se comporter de façon quasi identique avec les autres variables. Ainsi, il est possible d'en représenter qu'une seule des deux lors de l'analyse multivariée. Cette problématique sera abordée plus en détail dans la section \@ref(exploration-des-relations-avec-le-revenu).

En ce qui concerne la matrice de corrélation, deux variables ont été enlevées à des fins pratiques. La première est `wday` (les journées de la semaine) et la deuxième est `mem` (membre de bixi ou non ). Par contre, il est logique d'affirmer par déduction que ces deux variables restent tout de même intéressantes à croiser avec nos variables d'intérêt.

```{r MatricCorr, fig.cap= "Matrice de corrlélation", fig.width=10,fig.height=6}
my_colors  <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))(200)
corplot_dat <- dat %>% 
  select(-c(wday,mem))

corplot <- corrplot(cor(corplot_dat,use='pairwise.complete.obs'), 
                    method = "color",col = my_colors,
                    type = "upper", order = "hclust",
                    addCoef.col = "black",
                    tl.col = "black", tl.srt = 45,
                    sig.level = 0.01, insig = "blank",
                    diag = FALSE
                    )

```

### Exploration des relations avec la durée des trajets

En croisant la variable `dur` avec la variable `wday` qui représente les jours de la semaine et `mem` qui représente l'abonnement, nous pouvons obtenir le figure \@ref(fig:wday). Plusieurs analyses sont pertinentes à partir de ce graphique. D'abord, les membres utilisent beaucoup plus les Bixi (au niveau de la durée) que les non-membres, et ce, peu importe le jour de la semaine. Les types d'utilisation semblent aussi changé, par exemple, les non-membres utilisent plus les Bixi les fin de semaines alors que pour les membres, la tendance semble moins claire. En effet, les membres semblent avoir une utilisation croissante la semaine et décroissante la fin de semaine. Naturellemement, on pourrait penser que c'est parce qu'ils utilisent le Bixi comme un moyen de transport régulier pour aller au travail ou à l'école par exemple.

D'un point de vue d'affaire, il pourrait être intéressant pour l'entreprise Bixi de faire des accords avec les gros employeurs de Montréal pour augmenter ses clients et accélérer la transition vers des moyens de transport plus doux. Dans ce même ordre d'idée, la localisation des bixi proche des milieux de travail et des milieux scolaires devient une avenue intéressante si l'entreprise a pour bût d'augmenter son nombre d'abonnés mensuel. Bien sûr, ceci n'est qu'une hypothèse, pour l'affirmer il faudrait avoir des données géospatiales pour nous permettre d'associer l'achalandage durant la semaine aux points d'arriver.

```{r}
dat$wday <- factor(dat$wday,
                   levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

label <- c(`1` = "Membre", `0` = "Non membre")
```

```{r wday}
ggplot(dat, aes(x=wday, y=dur,
           fill = wday)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Blues")+
  facet_wrap(~ mem,labeller=labeller(mem=label))+
  theme(legend.position="none")+
  labs(title = "Durée totale des déplacement \npar jours selon les membres et les non membres")+
  xlab("")+
  ylab("Durée totale (en minutes) des déplacement")
```

```{r}
dat$wday <- factor(dat$wday,
                   levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

label <- c(`1` = "Membre", `0` = "Non membre")
```

En croisant la variable `dur` avec la variable `mm` qui représente les mois où il est possible de prendre un Bixi et `mem` qui représente l'abonnement, nous pouvons obtenir le figure \@ref(fig:mm). Plusieurs analyses sont pertinentes à partir de ce graphique. D'abord, les membres utilisent beaucoup plus les Bixi (au niveau de la durée) que les non-membres, et ce, peu importe le mois de l'année. D'une façon similaire, l'utilisation semble atteindre son pic vers août pour les deux types de clients. Il est aussi intéressant de constater que les membres utilisent moins les Bixi durant le moins de juillet. Cela semble concorder avec une affirmation précédente, les membres peuvent par exemple être en congé durant ce mois et ils utilisent donc moins les Bixi pour aller à leur occupation régulière.

```{r mm}
ggplot(dat, aes(as.factor(mm), dur, fill = as.factor(mm))) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Blues")+
  facet_wrap(~ mem,labeller=labeller(mem=label))+
  theme(legend.position="none")+
  scale_x_discrete(breaks = 4:11,labels=c("Avril","Mai","Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre")) +
  labs(title = "Durée totale des déplacement \npar jours selon les membres et les non membres")+
  xlab("")+
  ylab("Durée totale (en minutes) des déplacement")
```

En croisant la variable `dur` avec la variable `temp` qui représente la température moyenne de la journée et `mem` qui représente l'abonnement, nous pouvons obtenir le figure @ref(fig:temp). Naturellement, on voit une relation positive entre la température totale moyenne et la durée totale de déplacement. La relation semble toutefois ralentir voir stagner vers les 20°C. Cela peut pourrait venir du fdit que l'utilisation des Bixi est plus élevé en été (donc les mois avec une température plus élevé). Ainsi, ce graphique donne globalement les mêmes informations que le précédent étant donné que la température est fortemement corrélée avec les mois.

Au niveau des déplacements moyens (avec la variable `avg`), il semble que la durée moyenne des déplacements diminue après les 15°C.

Au niveau de la corrélation, elle est de 0.53 pour les non-membres et de 0.67 pour les membres pour le déplacement moyen total et de 0.26 pour les non-membres et de 0.34 pour les membres pour le déplacement moyen.

```{r}
dat_temp <- dat %>%
  select(mem, dur, temp, avg) %>% 
  group_by(temp, mem) %>%
  summarise(dur = (mean(dur)),
            avg = mean(avg))
```

```{r temp}
ggplot(dat_temp, aes(temp, dur)) +
  geom_point() +
  facet_wrap(~mem,labeller=labeller(mem=label))+
  geom_smooth(method='lm',  se=FALSE) +
  labs(title = "Durée totale des déplacement \npar jours selon les membres et les non membres")+
  xlab("Température journalière moyenne en °C")+
  ylab("Durée journalière totale moyenne des déplacement")

ggplot(dat_temp, aes(temp, avg)) +
  geom_point() +
  facet_wrap(~mem,labeller=labeller(mem=label))+
  geom_smooth(method='lm',  se=FALSE) +
  labs(title = "Durée moyenne des déplacement \npar jours selon les membres et les non membres")+
  xlab("Température journalière moyenne en °C")+
  ylab("Durée journalière moyenne des déplacement")

dat_temp_cor = dat_temp %>% 
  group_by(mem) %>%
  summarise(cor = cor(temp,dur),
            cor_avg = cor(temp,avg))
```

En croisant la variable `dur` avec la variable `rain` qui représente la précipitation totale de pluie lors de la journée et `mem` qui représente l'abonnement, nous pouvons obtenir le figure \@ref(fig:rain). Pour les non-membres l'effet de la pluie sur la durée totale moyenne n'est pas autant significative que pour les membres. Cela est assez étonnant, car il semble que les membres devraient avoir un usage régulier et ainsi moins sensible aux facteurs exogènes comme la pluie.

Au niveau des déplacements moyens (avec la variable `avg`), l'effet est assez similaire entre les membres et les non-membres, les déplacements sont en moyennes plus courts avec la pluie.

Au niveau de la corrélation entre la pluie et la durée totale moyenne des déplacements, elle est de -0.36 pour les membres et de -0.24 les non-membres. Pour la durée moyenne, les corrélations sont de -0.38 pour les membres et de -0.18 pour les non-membres.

```{r}
dat_rain <- dat %>%
  select(mem, dur, rain, avg) %>% 
  group_by(rain, mem) %>%
  summarise(dur = mean(dur),
            avg = mean(avg))

```

```{r rain}
ggplot(dat_rain, aes(rain, dur)) +
  geom_point() +
  facet_wrap(~mem,labeller=labeller(mem=label)) +
  geom_smooth(method='lm', se=FALSE) +
  labs(title = "Durée totale moyenne des déplacement \npar jours selon les membres et les non membres")+
  xlab("Précipitation")+
  ylab("Durée journalière totale moyenne des déplacement")

ggplot(dat_rain, aes(rain, avg)) +
  geom_point() +
  facet_wrap(~mem,labeller=labeller(mem=label)) +
  geom_smooth(method='lm', se=FALSE) +
  labs(title = "Durée moyenne des déplacement \npar jours selon les membres et les non membres")+
  xlab("Précipitation de pluie (en mm)")+
  ylab("Durée journalière moyenne des déplacement")

dat_rain_cor = dat_rain %>% 
  group_by(mem) %>%
  summarise(cor = cor(rain,dur),
            cor_avg = cor(rain,avg))
```

En croisant la variable `dur` et `avg` avec `mem` qui représente l'abonnement, nous pouvons obtenir le tableau \@ref(tab:tab-mem).

```{r}
dat_mem <- dat %>%
  select(mem, avg, dur) %>% 
  group_by(mem) %>%
  summarise(avg = mean(avg), dur = sum(dur)) %>% 
  mutate(dur_relative = ifelse(mem == 1, dur / sum(dat$mem == 1), dur / sum(dat$mem ==0))) %>% 
  mutate(mem = ifelse(mem == 1, "Membre", "Non-membre"))
```

```{r tab-mem}
kable(dat_mem, col.names = c("Membre", "Durée moyenne", "Durée totale", "Durée totale relative"), caption = "Détail sur la durée selon les abonnements")
```

La durée moyenne des trajets est assez similaire entre les membres et les non-membres. Cela est assez intéressant, car il est facile de penser que les membres utiliseraient plus les Bixi pour des trajets plus long. En revanche, les membres ont une durée totale de trajets beaucoup plus haute que les non-membres, ce qui rejoint ce que nous avions observé précédemment. Il apparait aussi que les membres sont responsables de la majeure partie des déplacements (en durée). Ainsi, selon la rentabilité du programme d'adhéesion (donnée non disponible), il pourrait être opportun d'attirer des nouveaux membres avec des promotions et des campagnes publicitaires.

En croisant la variable `dur` et `avg` avec `holiday` qui représente si le jour est férié ou non, nous pouvons obtenir le tableau \@ref(tab:tab-hol).

```{r tab-hol}
dat_hol <- dat %>%
  select(holiday, avg, dur) %>% 
  group_by(holiday) %>%
  summarise(avg = mean(avg), dur = sum(dur)) %>% 
  mutate(dur_relative = ifelse(holiday == 1, dur / sum(dat$holiday == 1), dur / sum(dat$holiday ==0))) %>% 
  mutate(holiday = ifelse(holiday == 1, "Férié", "Non férié"))


kable(dat_hol, col.names = c("Jour", "Durée moyenne", "Durée totale", "Durée totale relative"), caption = "Détail sur la durée selon les fériés")

```

La durée moyenne des trajets est légérement supérieure pour les jours fériés. Aussi, la durée totale relative des trajets est supérieure pendant les jours fériés. Cela s'explique par le fait que les usagers ont plus de temps disponible pour utiliser les Bixi. Il serait aussi avantageux pour Bixi d'augmenter la disponibilité des vélos lors des jours fériés.

Selon le graphique \@ref(fig:stat), il est possible de modéliser les stations par leur durée totale de déplacements de la saison. On voit que la plupart des stations sont sous le seuil des 10 000 minutes.

```{r stat}
dat_station = dat %>% group_by(station) %>% summarise(dur = sum(dur))
data <- dat_station[order(-dat_station$dur), ]

# Créer un graphique à barres classant les stations en ordre décroissant
ggplot(data, aes(x = factor(station, levels = unique(data$station)), y = dur)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(x = "Station", y = "Somme de la Durée", title = "Stations Classées en Ordre Décroissant par Somme de Durée") +
  scale_x_discrete(labels = rep("", length(data$station))) +
  theme(panel.grid.major.x = element_blank(),
        axis.ticks.x = element_blank())
  
top3_stat_dur = head(data, 3)
```

En fonction de la durée totale durant la saison, le top 3 des stations sont :

-   de la Commune / Place Jacques-Cartier (Vieux-Montréal)

-   de la Commune / St-Sulpice (Vieux-Montréal)

-   Métro Mont-Royal (Rivard / du Mont-Royal) (Plateau Mont-Royal)

Ainsi, on remarque que les deux stations les plus populaires en terme de durée sont situées dans le Vieux-Montréal. Il est possible d'attribuer cela aux touristes.

### Exploration des relations avec l'utilisation des Bixi

Dans la prochaine section, nous allons explorer les relations entre l'utilisation des Bixis, soit la variable `n_tot` (ainsi que `n_AM` et `n_PM` dans certains cas) et diverses variables de notre base de données.

La figure \@ref(fig:graph_n_tot_vs_temp) montre la relation entre le nombre de déplacement total moyen par jour par rapport à la température pour les membres et les non-membres.

```{r graph_n_tot_vs_temp}
dat_temp_ntot <- dat %>%
  select(mem, n_tot, temp) %>% 
  group_by(temp, mem) %>%
  summarise(n_tot = (mean(n_tot)))

ggplot(dat_temp_ntot, aes(temp, n_tot)) +
  geom_point() + geom_smooth(method='lm', se=FALSE) +
  facet_wrap(~mem,labeller=labeller(mem=label)) +
  labs(title = "Nombre moyen de déplacements \npar rapport à la température")+
  xlab("Température en °C")+
  ylab("Nombre de déplacement moyen")

dat_temp_ntot_cor = dat_temp_ntot %>% 
  group_by(mem) %>%
  summarise(cor = cor(temp,n_tot))
```

D'après ce graphique, il est possible de constater qu'il semble exister une relation linéaire entre le nombre de déplacement moyen effectué en Bixi et la température, que ce soit pour un membre et un non-membre. Dans les deux cas, on observe que le nombre de déplacement moyen a tendance à augmenter avec la température. Une forte corrélation positive de 0.65 pour les membres et une corrélation moyenne de 0.48 pour les non-membres.

D'un point de vue d'affaires, si l'entreprise Bixi désirerait par exemple effectuer une mise à jour logiciel ou effectuer de la maintenance sur certains vélos et que ceci nécessiterait de récupérer une certaines quantité de Bixi, il faudrait que l'entreprise entreprenne ces changements pendant les journées où il fait plus froid, ou durant les périodes plus froides soit durant les mois d'avril, mai, octobre ou novembre comme le montre le tableau \@ref(table:graph_temp_vs_mois) afin d'éviter de causer des problèmes de manque de vélos pour les usagers.

```{r graph_temp_vs_mois}

mean_temp_vs_mm <- round(aggregate(dat$temp~dat$mm, FUN=mean, na.rm = TRUE), digits=2)
kable(mean_temp_vs_mm, col.names = c("Mois","Température moyenne (°C)"), caption = "Température moyenne par mois")

```

Par la suite, nous avons observé la relation entre le nombre de déplacement total moyen par jour d'après la quantité de précipitation tombés dans une journée. La figure \@ref(fig:graph_n_tot_vs_rain) montre cette relation.

```{r graph_n_tot_vs_rain}
dat_rain_ntot <- dat %>%
  select(mem, n_tot, rain) %>% 
  group_by(rain, mem) %>%
  summarise(n_tot = (mean(n_tot)))

ggplot(dat_rain_ntot, aes(rain, n_tot)) +
  geom_point() + geom_smooth(method='lm', se=FALSE) +
  facet_wrap(~mem,labeller=labeller(mem=label)) +
  labs(title = "Nombre moyen de déplacements \npar rapport à la quantité de précipitations")+
  xlab("Quantité de précipitations (mm) par jour")+
  ylab("Nombre de déplacement moyen")

dat_rain_ntot_cor = dat_rain_ntot %>% 
  group_by(mem) %>%
  summarise(cor = cor(rain,n_tot))
```

D'après ce graphique, il semble y avoir une faible corrélation entre le nombre de déplacement et la quantité de précipitation dans une journée. En effet, la corrélation est de -0.26 pour les non-membres et -0.30 pour les membres.

La figure \@ref(fig:n_tot_vs_day) montre la relation entre le nombre de déplacement moyen pour différents moment de la journée et le nombre total de déplacement d'après la journée.

```{r n_tot_vs_day}

dat_n_tot_wday <- dat %>%
  select(mem, n_tot, wday, n_AM, n_PM) %>%
  group_by(wday, mem) %>%
  summarise(n_tot = mean(n_tot),
            n_AM =  mean(n_AM),
            n_PM =  mean(n_PM))%>%
            mutate(n_nuit = n_tot-n_AM-n_PM) %>% 
  select(wday,mem,n_AM,n_PM,n_nuit,n_tot)

dat_mean_n_tot_wday <- dat_n_tot_wday %>%
  group_by(mem) %>% 
  summarise(n_tot = mean(n_tot))

dat_n_tot_wday_2 <- tidyr::pivot_longer(dat_n_tot_wday, cols = starts_with("n_"), names_to = "moment", values_to = "nombre")

ggplot(data = dat_n_tot_wday_2, aes(x = wday, y = nombre, fill = factor(moment))) +
  geom_bar(stat = "identity", position = position_dodge(), width = 0.7) +
  facet_grid(mem ~ ., scales = "free_y", labeller = as_labeller(c('0' = "Non-membre", '1' = "Membre"))) +
  labs(title = "Nombre de déplacements moyen en Bixi d'aprés le jour de la semaine",
       x = "Jour de la semaine", y = "Nombre de déplacements moyen",
       fill = "Variable") +
  scale_fill_manual(values = c("n_AM" = "blue", "n_PM" = "red", "n_nuit" = "green", "n_tot" = "purple"),
                    name = "Moment de la journée",
                    labels = c("AM", "Nuit", "PM", "Total"))+
  geom_text(aes(label = round(nombre, 1)), position = position_dodge(width = 0.7), vjust = -0.5, size = 2)+
  scale_x_discrete(labels = c("Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"))+
  theme(strip.text = element_text(size = 12, face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1))

```

Pour les membres, on remarque qu'en moyenne, il y a plus de déplacements en après-midi qu'en avant-midi et durant la nuit. De façon générale, le nombre de déplacements en avant-midi est semblable à celui de la nuit. Il est aussi possible de remarquer que le nombre de déplacement total est très semblable pour tous les jours de la semaine et est un peu plus faible pour les jours de la fin de semaine. Finalement, on peut tirer de cela que les membres utilisent plus les Bixis durant la semaine pour aller au travail par exemple et que plus de membres les utilisent l'après-midi.

Pour les non-membres, il y a aussi plus de déplacements en après-midi qu'en avant-midi et durant la nuit. Puis, l'utilisation en avant-midi et la nuit est très semblable pour tous les jours aussi. Il est aussi possible de remarquer que le nombre de déplacement total est très semblable pour tous les jours. Cependant, contrairement aux membres, les jours de fin de semaine sont ceux avec le plus de déplacements. Finalement, on peut donc supposer que les non-membres sont plus porter à utiliser les Bixis les fins de semaines pour des loisirs et moins pour le travail la semaine.

En moyenne, le nombre de déplacement total pour les membres est plus élevé à 30.8 par jour et à 7.32 par jour pour les non-membres.

D'un point de vue d'affaires, comme les membres utilisent plus les Bixis la semaine et qu'il y a plus de déplacements pour les membres que les non-membres. Il serait judicieux de toujours s'assurer d'une bonne disponibilité de Bixi la semaine et ce surtout en après-midi. Si l'entreprise Bixi devait récupérer une certaine quantité de vélo pour la maintenance par exemple, nous suggérons qu'elle procède durant les avant-midi et/ou les fins de semaine.

Le tableau \\\@ref(fig:n_tot_vs_holiday) montre la relation entre le nombre de déplacement et si la journée est férié ou non.

```{r n_tot_vs_holiday}

dat_hol_n_tot <- dat %>%
  select(holiday, n_tot) %>% 
  group_by(holiday) %>%
  mutate(mean_n_tot = n_tot) %>% 
  summarise(mean_n_tot = mean(n_tot), n_tot = sum(n_tot)) %>%
  mutate(holiday = ifelse(holiday == 1, "Férié", "Non férié"))

kable(dat_hol_n_tot, col.names = c("Jour", "Nb. déplacement moyen", "Nb. déplacement total"), caption = "Détail sur le nombre de déplacement selon les fériés")

```

Ce tableau montre qu'en moyenne il y a un peu plus de déplacements durant les jours férié, mais on parle ici d'un peu plus qu'un seul déplacement. Ce qui ne semble pas assez significatif pour conclure que le nombre de déplacement est affecté par le fait qu'il s'agit d'un jour férié ou non.

La figure \\\@ref(fig:n_tot_vs_mois) représente la relation entre l'utilisation moyenne des Bixis et le mois de l'année.

```{r n_tot_vs_mois}

dat_n_tot_vs_mois <- dat %>%
  select(mem, n_tot, mm) %>% 
  group_by(mm, mem) %>%
  summarise(n_tot = (mean(n_tot)))

mois <- c(rep("Avril",2), rep("Mai",2), rep("Juin",2), rep("Juillet",2), rep("Août",2), rep("Septembre",2), rep("Octobre",2), rep("Novembre",2))

dat_n_tot_vs_mois <- dat_n_tot_vs_mois %>% mutate(mm=factor(mm, levels=c(4:11), ordered=TRUE))

ggplot(dat_n_tot_vs_mois, aes(x=mm, y=n_tot,
           fill = mois)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ mem,labeller=labeller(mem=label))+
  theme(legend.position="none")+
  labs(title = "Nombre de déplacement moyen\npar jours selon les membres et les non membres")+
  xlab("")+
  ylab("Nombre de déplacement moyen")+
  scale_x_discrete(labels = c("Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre"))+
  theme(strip.text = element_text(size = 12, face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1))+
  geom_text(aes(label = round(n_tot, 1)), position = position_dodge(width = 0.7), vjust = -0.5, size = 3)


memmois = (select(filter(dat_n_tot_vs_mois,mem ==1),n_tot))
nmemmois = (select(filter(dat_n_tot_vs_mois,mem ==0),n_tot))
cor_mois_m_vs_nm <- cor(memmois$n_tot,nmemmois$n_tot)
cor_mois_m_vs_avg_temp <- cor(memmois$n_tot,mean_temp_vs_mm$`dat$temp`)
cor_mois_nm_vs_avg_temp <- cor(nmemmois$n_tot,mean_temp_vs_mm$`dat$temp`)
```

On remarque que l'allure des deux graphiques est très semblable entre les membres et les non-membres. On parle ici d'une très forte corrélation de 0.86. On peut alors dire que le comportement des membres et des non-membres est très semblable par rapport au mois.

Par la suite, en comparant ces données avec les données du tableau \@ref(table:graph_temp_vs_mois) illustrant la moyenne des températures par mois, on obtient une très forte corrélation d'environ 0.85 pour les membres et une forte corrélation d'environ 0.59 pour les non-membres. Nous pouvons donc faire l'hypothèse que la relation entre le nombre de déplacement moyen par mois est dépendante de la température de ce mois. Les gens ont tendance à plus utiliser le Bixi lors des mois plus chauds que les mois plus froids (avril, octobre et novembre).

Cependant, on remarque que dans les deux cas (membre et non-membre), le mois avec le plus de déplacement moyen est le mois de septembre qui pourtant n'est pas le mois le plus chaud. Notre hypothèse est qu'il s'agit de la période de la rentrée scolaire et du retour au travail pour plusieurs, alors plusieurs optent pour un transport plus écologique comme le Bixi à ce moment de l'année avant de tomber dans la période plus froide de l'année avec les mois d'octobre et novembre.

D'un point de vue d'affaires, l'entreprise Bixi devrait prioriser et s'assurer de pouvoir mettre à disposition une grande quantité de Bixi pour les périodes plus chaudes de l'année ainsi qu'en septembre.

Par la suite, nous avons identifié les stations qui généraient le plus de déplacements pour les membres et les non-membres. Les deux tableaux \\\@ref(fig:n_tot_vs_station) présentent le nombre de déplacements total des 5 stations avec le plus de déplacements pour les membres et les non-membres ainsi que l'arrondissement de Montréal où se situe ces stations.

```{r n_tot_vs_station}

dat_n_tot_station <- dat %>%
  select(mem, n_tot, station) %>% 
  group_by(station, mem) %>%
  summarise(n_tot = (sum(n_tot)))

top_station_m <- dat_n_tot_station %>% 
  filter(mem == 1) %>% 
  arrange(desc(n_tot)) %>% 
  head(5) %>% 
  cbind(c("Métro Mont-Royal (Rivard / du Mont-Royal)","Prince-Arthur / du Parc","De Bréboeuf / du Mont-Royal",
          "Messier / Du Mont-Royal", "Boyer / du Mont-Royal")) %>% 
  cbind(c("Plateau Mont-Royal","Plateau Mont-Royal","Plateau Mont-Royal","Plateau Mont-Royal","Plateau Mont-Royal"))  %>% 
  select(-matches("^mem"))

colnames(top_station_m)[3] <- "Emplacement"
colnames(top_station_m)[4] <- "Arrondissement"

top_station_m <- top_station_m%>% 
  select(station, Emplacement,Arrondissement, n_tot)

top_station_nm <- dat_n_tot_station %>% 
  filter(mem == 0) %>% 
  arrange(desc(n_tot)) %>% 
  head(5) %>% 
  cbind(c("de la Commune / Place Jacques-Cartier","Duluth / St-Laurent","Métro Mont-Royal (Rivard / du Mont-Royal)",
          "St-Dominique / Napoléon", "de la Commune / St-Sulpice")) %>% 
  cbind(c("Le Vieux Montréal","Plateau Mont-Royal","Plateau Mont-Royal","Plateau Mont-Royal","Le Vieux Montréal")) %>% 
  select(-matches("^mem"))

colnames(top_station_nm)[3] <- "Emplacement_nm"
colnames(top_station_nm)[4] <- "Arrondissement_nm"

top_station_nm <- top_station_nm%>% 
  select(station, Emplacement_nm,Arrondissement_nm,n_tot)

kable(top_station_m, col.names = c("Stations","Emplacement","Arrondissement", "Nb. de déplacement total"), caption = "Détail sur les stations les plus utilisées pour les membres") 

kable(top_station_nm, col.names = c("Stations","Emplacement","Arrondissement", "Nb. de déplacement total"), caption = "Détail sur les stations les plus utilisées pour les non-membres") 


```

On remarque que l'arrondissement avec le plus de stations dans le top 5 est la Plateau Mont-Royal et Le Vieux-Montréal (pour deux stations). D'un point de vue d'affaires, il serait pertinent de prioriser ces arrondissements pour l'ajout de nouveaux Bixis par exemple pour s'assurer qu'il n'en manque jamais et toujours en avoir une grande quantité en fonction dans ces arrondissements. Puis, aussi d'effectuer plus de maintenance préventive des installations de ces arrondissements, car celles-ci génèrent beaucoup de d'attraction et il ne faudrait pas qu'elles soient hors service.



À ajouter dans Conclusion (Conclusion Sam partie n_tot)

Pour conclure, on peut constater que les périodes d'utilisation les plus faibles de Bixis sont: les journées plus froides, les mois plus froids (avril, octobre et novembre), la fin de semaine et l'avant-midi. Puis les périodes avec le plus de déplacements sont les journées plus chaudes, les mois plus chaud (les autres mois à l'étude), durant la semaine et en après-midi. De plus, les secteurs avec les stations qui génèrent le plus de déplacements sont le Plateau Mont-Royal et le Vieux-Montréal. Finalement, l'entreprise devraient donc s'assurer de toujours avoir le plus de Bixis possibles disponibles pour les périodes fortes, procéder aux maintenances lors des périodes plus faibles et s'assurer du bonne état des stations et des vélos dans les arrondissements avec les stations les plus en demande.


### Exploration des relations avec le revenu

Dans cette section, il sera principalement question de la variable revenu `rev`, puisque c'est la variable qui met en relation le revenu généré par les non-membres avec les autres variables. De ce fait, d'un point de vue entrepreneurial, c'est une variable d'intérêt capital, puisqu'elle participe au calcul de profit de BIXI. Cependant, puisque l'encodage des données du revenu n'est offert que pour les non-membres et que le revenu est calculé à partir de la durée du trajet, la corrélation entre ces deux dernières est relativement forte comme on peut le voir dans le tableau \@ref(fig:MatricCorr). Autrement dit, l'etntreprise peut constater qu'une augmentation de la durée des trajets `dur` revient principalment à une augmentation du revenu `rev`. Conséquemment, visualiser la relation entre le revenu et les journées de la semaine `wday`, le mois `mm`, la température `temp` et les précipitations `rain` reviennent à visualiser la même chose que dans la sections de l'exploration des relations avec la durée des trajets. Dès lors, il reste néanmoins intéressant d'observer comment le revenu se comporte lors des journées fériées `holiday`.

Dans le cas de la relation entre les journées fériées et le revenu, il est possible d'apercevoir qu'en moyenne les non-membres utilisent plus bixi lors des journées fériées, puisque le revenu moyen est plus élevé lors de ces journées (\@ref(tab:RevVSholiday)). Cela étant dit, il y a un parallèle à faire avec la figure illustrée plus haut \@ref(fig:wday) où l'on peut voir que les non-membres ont plus tendance à se déplacer en bixi la fin de semaine. Par conséquent, on peut soutenir l'hypothèse que l'utilisation de bixi par les non-membres est liée à des fins plus récréatives.

Du point de vue de l'entreprise, la localisation des stations de bixi pour les non-membres devient alors cruciale. Autrement dit, placer des stations de bixi proches des lieux culturels et les lieux de divertissement pourraient ainsi favoriser le revenu de l'entreprise.

```{r RevVSholiday}

df_Nmem_compl <- dat  %>% subset(mem == '0')

dat_rev <- df_Nmem_compl %>%
  select(rev, holiday) %>% 
  group_by(holiday) %>%
  summarise(rev_moyen = mean(rev),rev_total = sum(rev)) %>% 
  mutate(holiday = ifelse(holiday == 1, "Journée fériée", "journée normale"))


kable(dat_rev, col.names = c("", "Revenu moyen", "Revenu total"), caption = "Détails entre les journées fériées et le revenu rapporté par les non-membres")
```

# Conclusion {.unnumbered}
